{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "title": "PlatformRequest",
  "description": "AI platform request sent to an AIP operator to initiate an ad auction. UCP (User Context Protocol) aligned structure.",
  "type": "object",
  "required": [
    "spec_version",
    "message_id",
    "timestamp",
    "producer",
    "context",
    "identity",
    "extensions"
  ],
  "properties": {
    "spec_version": {
      "type": "string",
      "description": "UCP specification version",
      "example": "1.0.0"
    },
    "message_id": {
      "type": "string",
      "description": "Unique identifier for this auction request",
      "example": "req_92fA1"
    },
    "timestamp": {
      "type": "string",
      "format": "date-time",
      "description": "ISO timestamp of the event",
      "example": "2025-11-14T18:22:00Z"
    },
    "producer": {
      "type": "object",
      "required": ["agent_id", "agent_role", "software", "software_version"],
      "properties": {
        "agent_id": {
          "type": "string",
          "description": "Identifier of the AI platform sending this request",
          "example": "openai_chat"
        },
        "agent_role": {
          "type": "string",
          "description": "Role of the agent, typically 'publisher'",
          "example": "publisher"
        },
        "software": {
          "type": "string",
          "description": "Software name",
          "example": "chatgpt"
        },
        "software_version": {
          "type": "string",
          "description": "Software version or model identifier",
          "example": "4.3-mini"
        }
      }
    },
    "context": {
      "type": "object",
      "required": ["context_id", "language", "publisher", "placement", "device", "geography"],
      "properties": {
        "context_id": {
          "type": "string",
          "description": "Unique context identifier",
          "example": "ctx_raw_92fA1"
        },
        "language": {
          "type": "string",
          "pattern": "^[a-z]{2}-[A-Z]{2}$",
          "description": "User locale in BCP 47 format",
          "example": "en-US"
        },
        "publisher": {
          "type": "string",
          "description": "Publisher identifier (same as producer.agent_id)",
          "example": "openai_chat"
        },
        "placement": {
          "type": "object",
          "required": ["ad_unit"],
          "properties": {
            "ad_unit": {
              "type": "string",
              "description": "Platform surface type: chat, voice, browser, extension, ui panel, etc.",
              "example": "conversation"
            }
          }
        },
        "device": {
          "type": "object",
          "required": ["platform", "form_factor"],
          "properties": {
            "platform": {
              "type": "string",
              "description": "Device platform: web, mobile, etc.",
              "example": "web"
            },
            "form_factor": {
              "type": "string",
              "enum": ["mobile", "desktop", "tablet"],
              "description": "Device form factor",
              "example": "desktop"
            },
            "ua_hash": {
              "type": "string",
              "description": "User agent hash",
              "example": "ua_hash_xyz"
            }
          }
        },
        "geography": {
          "type": "object",
          "required": ["country"],
          "properties": {
            "country": {
              "type": "string",
              "pattern": "^[A-Z]{2}$",
              "description": "User country code (ISO 3166-1 alpha-2)",
              "example": "US"
            }
          }
        }
      }
    },
    "identity": {
      "type": "object",
      "required": ["namespace", "value_hash", "confidence"],
      "properties": {
        "namespace": {
          "type": "string",
          "description": "Identity namespace",
          "example": "platform_user"
        },
        "value_hash": {
          "type": "string",
          "description": "Anonymous hashed user ID",
          "example": "user_hash_abc123"
        },
        "confidence": {
          "type": "number",
          "minimum": 0,
          "maximum": 1,
          "description": "Confidence level for identity",
          "example": 1.0
        }
      }
    },
    "extensions": {
      "type": "object",
      "required": ["aip"],
      "properties": {
        "aip": {
          "type": "object",
          "required": ["session_id", "turn_index", "query_text"],
          "properties": {
            "session_id": {
              "type": "string",
              "description": "Conversation or interaction session ID",
              "example": "sess_001"
            },
            "conversation_id": {
              "type": "string",
              "description": "Conversation ID if independent from session_id",
              "example": "conv_xyz789"
            },
            "turn_index": {
              "type": "integer",
              "minimum": 0,
              "description": "Turn index in the conversation",
              "example": 3
            },
            "query_text": {
              "type": "string",
              "description": "User's raw query text",
              "example": "best CRM for small teams"
            },
            "messages": {
              "type": "array",
              "description": "Optional short conversation history (last N turns). Used for operator intent inference.",
              "items": {
                "type": "object",
                "properties": {
                  "role": {
                    "type": "string",
                    "enum": ["user", "assistant", "system"],
                    "example": "user"
                  },
                  "content": {
                    "type": "string",
                    "example": "best CRM tools?"
                  },
                  "id": {
                    "type": "string",
                    "description": "Optional message ID",
                    "example": "msg_123"
                  }
                }
              },
              "example": [
                { "role": "user", "content": "best CRM tools?" },
                { "role": "assistant", "content": "HubSpot, Zoho, Salesforce…" }
              ]
            },
            "latency_budget_ms": {
              "type": "integer",
              "description": "Optional latency budget from platform in milliseconds",
              "example": 500
            },
            "cpx_floor": {
              "type": "number",
              "description": "Minimum CPX (USD) required by the platform for this auction request",
              "example": 0.05
            }
          }
        }
      },
      "additionalProperties": true
    }
  },
  "examples": [
    {
      "spec_version": "1.0.0",
      "message_id": "req_92fA1",
      "timestamp": "2025-11-14T18:22:00Z",
      "producer": {
        "agent_id": "openai_chat",
        "agent_role": "publisher",
        "software": "chatgpt",
        "software_version": "4.3-mini"
      },
      "context": {
        "context_id": "ctx_raw_92fA1",
        "language": "en-US",
        "publisher": "openai_chat",
        "placement": {
          "ad_unit": "conversation"
        },
        "device": {
          "platform": "web",
          "form_factor": "desktop",
          "ua_hash": "ua_hash_xyz"
        },
        "geography": {
          "country": "US"
        }
      },
      "identity": {
        "namespace": "platform_user",
        "value_hash": "user_hash_abc123",
        "confidence": 1.0
      },
      "extensions": {
        "aip": {
          "session_id": "sess_001",
          "conversation_id": "conv_xyz789",
          "turn_index": 3,
          "query_text": "best CRM for small teams",
          "messages": [
            { "role": "user", "content": "best CRM tools?" },
            { "role": "assistant", "content": "HubSpot, Zoho, Salesforce…" }
          ],
          "latency_budget_ms": 500,
          "cpx_floor": 0.05
        }
      }
    }
  ],
  "$id": "https://aip.org/schemas/platform-request.json"
}
