{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "https://aip.org/schemas/ledger-record.json",
  "title": "LedgerRecord",
  "description": "Final ledger record summarizing reserved amount, actual billing, and revshare settlement.",
  "type": "object",
  "required": [
    "serve_token",
    "session_id",
    "auction_id",
    "platform_id",
    "brand_agent_id",
    "state",
    "reserved_unit",
    "reserved_amount_micros",
    "final_unit",
    "final_amount_micros",
    "currency",
    "timestamps"
  ],
  "properties": {
    "serve_token": {
      "type": "string",
      "description": "Unique token linking exposure → click → conversion",
      "example": "stk_abcxyz123"
    },
    "session_id": {
      "type": "string",
      "description": "Session identifier",
      "example": "sess_001"
    },
    "auction_id": {
      "type": "string",
      "description": "Auction identifier",
      "example": "auc_981"
    },
    "platform_id": {
      "type": "string",
      "description": "Platform identifier",
      "example": "pf_chatgpt"
    },
    "brand_agent_id": {
      "type": "string",
      "description": "Brand agent responsible for the bid",
      "example": "ba_451"
    },
    "state": {
      "type": "string",
      "enum": ["PENDING", "EXPOSED", "CLICKED", "CONVERTED", "FINALIZED", "REFUNDED"],
      "description": "Final state of the ad lifecycle",
      "example": "FINALIZED"
    },
    "reserved_unit": {
      "type": "string",
      "enum": ["CPX", "CPC", "CPA"],
      "description": "Pricing unit reserved at auction time",
      "example": "CPA"
    },
    "reserved_amount_micros": {
      "type": "integer",
      "minimum": 0,
      "description": "Maximum amount held from advertiser wallet (in USD micros, int64)",
      "example": 5000000
    },
    "final_unit": {
      "type": "string",
      "enum": ["CPX", "CPC", "CPA"],
      "description": "Final pricing unit applied after events",
      "example": "CPC"
    },
    "final_amount_micros": {
      "type": "integer",
      "minimum": 0,
      "description": "Actual charge applied to advertiser wallet (in USD micros, int64)",
      "example": 1200000
    },
    "currency": {
      "type": "string",
      "pattern": "^[A-Z]{3}$",
      "description": "Currency code (always USD)",
      "enum": ["USD"],
      "example": "USD"
    },
    "timestamps": {
      "type": "object",
      "description": "Event timestamps",
      "properties": {
        "auction": { "type": "string", "format": "date-time" },
        "exposure": { "type": "string", "format": "date-time" },
        "click": { "type": "string", "format": "date-time" },
        "conversion": { "type": "string", "format": "date-time" },
        "finalized": { "type": "string", "format": "date-time" }
      },
      "example": {
        "auction": "2025-11-11T18:00:00Z",
        "exposure": "2025-11-11T18:00:01Z",
        "click": "2025-11-11T18:02:00Z",
        "finalized": "2025-11-11T19:00:00Z"
      }
    },
    "revenue_share": {
      "type": "object",
      "description": "Revenue distribution breakdown (in USD micros)",
      "properties": {
        "platform_micros": { "type": "integer", "minimum": 0, "description": "Platform share in USD micros" },
        "operator_micros": { "type": "integer", "minimum": 0, "description": "Operator share in USD micros" }
      },
      "example": {
        "platform_micros": 300000,
        "operator_micros": 900000
      }
    },
    "ext": {
      "$ref": "./common.json#/definitions/extensionNamespace"
    }
  }
}
