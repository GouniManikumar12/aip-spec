{
  "$id": "https://aip.org/schemas/event-cpx-exposure.json",
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "title": "CPXExposureEvent",
  "description": "Event fired when the ad is actually exposed to the user.",
  "type": "object",

  "required": [
    "event_type",
    "serve_token",
    "session_id",
    "platform_id",
    "brand_agent_id",
    "wallet_id",
    "pricing",
    "timestamp"
  ],
  "properties": {
    "event_type": {
      "type": "string",
      "const": "cpx_exposure",
      "description": "Exposure event type.",
      "example": "cpx_exposure"
    },

    "serve_token": {
      "type": "string",
      "description": "Serve token provided in auction-result. Used to link exposure → click → conversion.",
      "example": "stk_abcxyz123"
    },

    "session_id": {
      "type": "string",
      "description": "Session identifier passed from platform_request.",
      "example": "sess_001"
    },

    "platform_id": {
      "type": "string",
      "description": "ID of the platform generating the event.",
      "example": "pf_openai_chat"
    },

    "brand_agent_id": {
      "type": "string",
      "description": "Winning brand agent from the auction-result.",
      "example": "ba_451"
    },

    "wallet_id": {
      "type": "string",
      "description": "Wallet that will be charged for this exposure.",
      "example": "w_0021"
    },
    "pricing": {
      "type": "object",
      "required": ["unit", "amount_cents"],
      "properties": {
        "unit": {
          "type": "string",
          "const": "CPX",
          "description": "Billing unit for this event.",
          "example": "CPX"
        },
        "amount_cents": {
          "type": "integer",
          "description": "Charge amount in CENTS. (bid = pay)",
          "minimum": 0,
          "example": 5
        }
      }
    },
    "exposure_metadata": {
      "type": "object",
      "description": "Optional additional rendering context.",
      "properties": {
        "context_channel": {
          "type": "string",
          "enum": ["ai_chat", "voice_assistant", "agentic"],
          "description": "Where the ad was displayed.",
          "example": "ai_chat"
        },
        "position": {
          "type": "integer",
          "minimum": 1,
          "description": "Position in the LLM or assistant output (if relevant).",
          "example": 1
        },
        "visibility_ms": {
          "type": "integer",
          "minimum": 0,
          "description": "How long the ad was visible (if measurable).",
          "example": 1200
        }
      }
    },
    "timestamp": {
      "type": "string",
      "format": "date-time",
      "description": "Timestamp when the exposure was detected.",
      "example": "2025-11-14T18:00:00Z"
    },

    "ext": {
      "$ref": "./common.json#/definitions/extensionNamespace"
    }
  },

  "examples": [
    {
      "event_type": "cpx_exposure",
      "serve_token": "stk_abcxyz123",
      "session_id": "sess_001",
      "platform_id": "pf_openai_chat",
      "brand_agent_id": "ba_451",
      "wallet_id": "w_0021",
      "pricing": {
        "unit": "CPX",
        "amount_cents": 5
      },
      "exposure_metadata": {
        "context_channel": "ai_chat",
        "position": 1,
        "visibility_ms": 1200
      },
      "timestamp": "2025-11-14T18:00:00Z"
    }
  ]
}
